<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Library</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
</head>
<body>
<form name="findBooks">
    <input type="hidden" name="id" value="0"/>
    <h2>Найти книгу</h2>
    <div class="form-group">
        <label for="name">Название книги:</label>
        <input id="inputName" class="form-control" name="bookName"/>
    </div>
    <div class="form-group">
        <label for="author">Автор:</label>
        <input id="inputAuthor" class="form-control" name="author"/>
    </div>
    <div class="panel-body">
        <a id="Create" class="btn btn-sm btn-primary">Добавить книгу</a>
        <a id="Find" class="btn btn-sm btn-primary">Найти книги</a>
        <a id="All" class="btn btn-sm btn-primary">Показать все книги библиотеки</a>
        <a id="RegisterUser" href="RegisterForm.html" class="btn btn-sm btn-primary">Зарегистрировать абонента</a>
    </div>
</form>

<h2>Результат поиска</h2>
<div id="baza"></div>

<script>
    $("#All").click(function (e) {
        $.ajax({
            url: "/books",
            type: "GET",
            contentType: "application/json",
            success: function (books) {
                $("#baza").html(books);
                console.log(books)
            }
        });
    });

       $("#Create").click(function (e) {
        var form = document.forms["findBooks"];
        var name = form.elements["bookName"].value;
        var author = form.elements["author"].value;
        $.ajax({
            url: "addBook",
            contentType: "application/json",
            method: "POST",
            data: JSON.stringify({
                name: name,
                author: author
            })
        });
        $('#All').triggerHandler('click');
    });

    $("#Find").click(function (e) {
        var form = document.forms["findBooks"];
        var name = form.elements["bookName"].value;
        var author = form.elements["author"].value;

        $.ajax({
            url: "findBooks",
            contentType: "application/json",
            method: "POST",
            data: JSON.stringify({
                name: name,
                author: author
            }),
            success: function (books) {
                $("#baza").html(books);
                console.log(books);
            }
        });
    });

    function issueBook(id, number) {
        $.ajax({
            url: "issueBook",
            contentType: "application/json",
            method: "POST",
            data: JSON.stringify({
                id: id,
                number: number
            }),
            success: function (result) {
                if (result=='Not found') alert('Введенный номер билета не зарегистрирован')
            }
        });
        $('#All').triggerHandler('click');
    }

    function returnBook(id) {
        $.ajax({
            url: "returnBook",
            contentType: "application/json",
            method: "POST",
            data: JSON.stringify({
                id: id
            })
        });
        $('#All').triggerHandler('click');
    }

    function deleteBook(id) {
        $.ajax({
            url: "deleteBook",
            contentType: "application/json",
            method: "POST",
            data: JSON.stringify({
                id: id
            })
        });
        $('#All').triggerHandler('click');
    }


    $("body").on("click", ".issueLink", function () {
        var id = this.id;
        var number = prompt('Введите номер читательского билета абонента, которому будет выдана книга');
        issueBook(id, number);
        $('#All').triggerHandler('click');
    });

    $("body").on("click", ".returnLink", function () {
        var id = this.id;
        returnBook(id);
    });

    $("body").on("click", ".deleteLink", function () {
        var id = this.id;
        deleteBook(id);
    });

    $("#inputName").keyup(function (e) {
        $('#Find').triggerHandler('click');
    });

    $("#inputAuthor").keyup(function (e) {
        $('#Find').triggerHandler('click');
    });

    $('#All').triggerHandler('click');

</script>
</body>
</html>